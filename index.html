<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Atterra Navicella</title>
    <style>
        body {
            margin: 0;
            background: black;
            color: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        #gioco {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: none;
        }
        #navicella {
            width: 60px;
            height: 25px;
            background: gray;
            position: absolute;
            border-radius: 10px;
        }
        #piattaforma {
            width: 100px;
            height: 10px;
            background: green;
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }
        #menu, #messaggio, #negozio, #pausa {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10;
        }
        button {
            padding: 10px;
            margin: 10px;
            cursor: pointer;
        }
        .statistiche {
            position: absolute;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
<div id="menu">
    <h1>Atterra Navicella</h1>
    <button onclick="iniziaGioco()">Gioca</button>
</div>

<div id="gioco">
    <div id="navicella"></div>
    <div id="piattaforma"></div>
    <div class="statistiche">
        <div id="velocita">Velocità: 0</div>
        <div id="carburante">Carburante: 100%</div>
        <div id="monete">Monete: 0</div>
        <div id="livello">Livello: 1</div>
    </div>
</div>

<div id="messaggio" style="display:none">
    <h2 id="testoMessaggio"></h2>
    <button onclick="continuaGioco()">Continua</button>
    <button onclick="tornaMenu()">Menu</button>
</div>

<div id="pausa" style="display:none">
    <h2>Gioco in pausa</h2>
    <button onclick="riprendiGioco()">Riprendi</button>
    <button onclick="tornaMenu()">Menu</button>
</div>

<div id="negozio" style="display:none">
    <h2>Negozio</h2>
    <button onclick="compraCarburante(10, 20)">+20% Carburante (10 monete)</button>
    <button onclick="compraMotore(30)">Motore migliorato (30 monete)</button>
    <button onclick="chiudiNegozio()">Chiudi</button>
</div>

<script>
// Variabili globali semplici
let x = 100, y = 50, vy = 0;
let gravita = 0.05;
let carburante = 100;
let monete = 0;
let livello = 1;
let motore = 1;
let inPausa = false;
let fineGioco = false;

let sinistra = false;
let destra = false;
let su = false;

const navicella = document.getElementById("navicella");
const piattaforma = document.getElementById("piattaforma");
const gioco = document.getElementById("gioco");
const menu = document.getElementById("menu");
const messaggio = document.getElementById("messaggio");
const testoMessaggio = document.getElementById("testoMessaggio");

function iniziaGioco() {
    menu.style.display = "none";
    gioco.style.display = "block";
    x = 100;
    y = 50;
    vy = 0;
    carburante = 100;
    fineGioco = false;
    aggiornaSchermo();
    richiestaAnimazione();
}

function richiestaAnimazione() {
    if (!fineGioco && !inPausa) requestAnimationFrame(aggiorna);
}

function aggiorna() {
    if (su && carburante > 0) {
        vy -= 0.2 * motore;
        carburante -= 0.3;
    }
    vy += gravita;
    y += vy;

    if (sinistra) x -= 2;
    if (destra) x += 2;

    navicella.style.left = x + "px";
    navicella.style.top = y + "px";

    document.getElementById("velocita").innerText = "Velocità: " + vy.toFixed(2);
    document.getElementById("carburante").innerText = "Carburante: " + Math.floor(carburante) + "%";
    document.getElementById("monete").innerText = "Monete: " + monete;
    document.getElementById("livello").innerText = "Livello: " + livello;

    const r1 = navicella.getBoundingClientRect();
    const r2 = piattaforma.getBoundingClientRect();
    if (r1.bottom >= r2.top && r1.left < r2.right && r1.right > r2.left) {
        if (vy < 1) {
            mostraMessaggio("Ben fatto!");
            monete += 10;
            livello++;
        } else {
            mostraMessaggio("Troppo veloce!");
        }
        fineGioco = true;
        return;
    }
    if (y > window.innerHeight - 20) {
        mostraMessaggio("Hai fallito!");
        fineGioco = true;
        return;
    }
    richiestaAnimazione();
}

function mostraMessaggio(testo) {
    testoMessaggio.innerText = testo;
    messaggio.style.display = "flex";
}

function continuaGioco() {
    messaggio.style.display = "none";
    iniziaGioco();
}

function tornaMenu() {
    gioco.style.display = "none";
    messaggio.style.display = "none";
    menu.style.display = "flex";
}

function compraCarburante(prezzo, quantita) {
    if (monete >= prezzo) {
        monete -= prezzo;
        carburante += quantita;
        chiudiNegozio();
    }
}

function compraMotore(prezzo) {
    if (monete >= prezzo) {
        monete -= prezzo;
        motore += 0.2;
        chiudiNegozio();
    }
}

function chiudiNegozio() {
    document.getElementById("negozio").style.display = "none";
    inPausa = false;
    richiestaAnimazione();
}

function riprendiGioco() {
    inPausa = false;
    document.getElementById("pausa").style.display = "none";
    richiestaAnimazione();
}

window.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft" || e.key === "a") sinistra = true;
    if (e.key === "ArrowRight" || e.key === "d") destra = true;
    if (e.key === "ArrowUp" || e.key === "w") su = true;
    if (e.key === "p") {
        inPausa = !inPausa;
        document.getElementById("pausa").style.display = inPausa ? "flex" : "none";
        if (!inPausa) richiestaAnimazione();
    }
    if (e.key === "s") {
        inPausa = true;
        document.getElementById("negozio").style.display = "flex";
    }
});

window.addEventListener("keyup", (e) => {
    if (e.key === "ArrowLeft" || e.key === "a") sinistra = false;
    if (e.key === "ArrowRight" || e.key === "d") destra = false;
    if (e.key === "ArrowUp" || e.key === "w") su = false;
});
</script>
</body>
</html>
